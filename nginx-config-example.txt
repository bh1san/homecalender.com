# This is an example Nginx configuration file for your Next.js application
# after setting up SSL with Certbot. Certbot will typically make these
# changes for you automatically.

# NOTE: Your new server IP address is 178.128.97.241.
# You must update the 'A' record for homecalender.com at your domain
# registrar to point to this new IP address.

# This first server block handles HTTP traffic on port 80.
# Certbot usually modifies it to redirect all traffic to HTTPS.
server {
    listen 80;
    listen [::]:80;
    server_name homecalender.com www.homecalender.com;

    # This line, added by Certbot, performs the 301 redirect to HTTPS.
    return 301 https://$host$request_uri;
}

# This second server block handles the secure HTTPS traffic on port 443.
server {
    # Listen on port 443 for https traffic.
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name homecalender.com www.homecalender.com;

    # These lines specify the path to the SSL certificate and private key.
    # Certbot will generate these and fill in the paths for you.
    ssl_certificate /etc/letsencrypt/live/homecalender.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/homecalender.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;


    # This block handles the reverse proxy. It passes requests to your
    # Next.js application, which you have running on port 3000 with pm2.
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
